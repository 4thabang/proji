version: 2

jobs:
  build:
    working_directory: ~/create_project
    docker:
      - image: circleci/python:3.7.4

    steps:
      - checkout

      - run:
          name: create config directory
          command: |
            mkdir -p ~/.config/create_project/db
            cp -r templates ~/.config/create_project/

      - run:
          name: install and setup database
          command: |
            sudo apt install -y sqlite3 || true
            sqlite3 ~/.config/create_project/db/cp.sqlite3 < scripts/create_basic_db.sql

      - run:
          name: install python dependencies
          command: |
            pip install --user -r requirements.txt

      - run:
          name: run tests
          command: |
            pytest

      - store_test_results:
          path: test-results-python-3.7.4
      - store_artifacts:
          path: test-results-python-3.7.4
          destination: trp374
